<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Planner PWA</title>
    
    <!-- PWA Manifest (Embedded) -->
    <link rel="manifest" id="manifest-placeholder">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#1e293b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        @media print {
            body * { visibility: hidden; }
            .printable-content, .printable-content * { visibility: visible; }
            .printable-content { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; border: none; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICON SYSTEM (Inline SVGs for Offline Capability) ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            LayoutDashboard: (props) => <Icon {...props} path={<><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></>} />,
            ClipboardList: (props) => <Icon {...props} path={<><rect width="8" height="4" x="8" y="2" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></>} />,
            Users: (props) => <Icon {...props} path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>} />,
            Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></>} />,
            PieChart: (props) => <Icon {...props} path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>} />,
            FileText: (props) => <Icon {...props} path={<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></>} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14" /><path d="M12 5v14" /></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />,
            Pencil: (props) => <Icon {...props} path={<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></>} />,
            Menu: (props) => <Icon {...props} path={<><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>} />,
            X: (props) => <Icon {...props} path={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>} />,
            DollarSign: (props) => <Icon {...props} path={<><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></>} />,
            TrendingUp: (props) => <Icon {...props} path={<><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></>} />,
            AlertTriangle: (props) => <Icon {...props} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" x2="12" y1="9" y2="13" /><line x1="12" x2="12.01" y1="17" y2="17" /></>} />,
            Activity: (props) => <Icon {...props} path={<><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></>} />,
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></>} />,
            ShieldCheck: (props) => <Icon {...props} path={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><path d="m9 12 2 2 4-4" /></>} />
        };

        // --- DATA SERVICE (Local Storage Adapter) ---
        const DataService = {
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch { return []; }
            },
            set: (key, data) => {
                localStorage.setItem(key, JSON.stringify(data));
            },
            add: (collection, item) => {
                const current = DataService.get(collection);
                const newItem = { ...item, id: Date.now().toString(), createdAt: new Date().toISOString() };
                const updated = [newItem, ...current];
                DataService.set(collection, updated);
                return updated;
            },
            update: (collection, id, updates) => {
                const current = DataService.get(collection);
                const updated = current.map(item => item.id === id ? { ...item, ...updates } : item);
                DataService.set(collection, updated);
                return updated;
            },
            delete: (collection, id) => {
                const current = DataService.get(collection);
                const updated = current.filter(item => item.id !== id);
                DataService.set(collection, updated);
                return updated;
            }
        };

        // --- MAIN APP COMPONENT ---
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            
            // Data States
            const [paps, setPaps] = useState([]);
            const [team, setTeam] = useState([]);
            const [swot, setSwot] = useState([]);
            const [bsc, setBsc] = useState([]);
            const [loading, setLoading] = useState(true);

            // Initial Load
            useEffect(() => {
                setPaps(DataService.get('strat_paps'));
                setTeam(DataService.get('strat_team'));
                setSwot(DataService.get('strat_swot'));
                setBsc(DataService.get('strat_bsc'));
                setLoading(false);
            }, []);

            // Stats
            const stats = useMemo(() => {
                const totalBudget = paps.reduce((acc, curr) => acc + (parseFloat(curr.budget) || 0), 0);
                const totalProjects = paps.length;
                const teamSize = team.length;
                const completionRate = paps.length > 0 
                    ? Math.round((paps.filter(p => p.status === 'Completed').length / paps.length) * 100) 
                    : 0;
                return { totalBudget, totalProjects, teamSize, completionRate };
            }, [paps, team]);

            // CRUD Handlers
            const handleAddPap = (item) => setPaps(DataService.add('strat_paps', item));
            const handleUpdatePap = (id, item) => setPaps(DataService.update('strat_paps', id, item));
            const handleDeletePap = (id) => setPaps(DataService.delete('strat_paps', id));

            const handleAddTeam = (item) => setTeam(DataService.add('strat_team', item));
            const handleUpdateTeam = (id, item) => setTeam(DataService.update('strat_team', id, item));
            const handleDeleteTeam = (id) => setTeam(DataService.delete('strat_team', id));

            const handleAddSwot = (item) => setSwot(DataService.add('strat_swot', item));
            const handleDeleteSwot = (id) => setSwot(DataService.delete('strat_swot', id));

            const handleAddBsc = (item) => setBsc(DataService.add('strat_bsc', item));
            const handleDeleteBsc = (id) => setBsc(DataService.delete('strat_bsc', id));

            if (loading) return <div className="flex items-center justify-center h-screen bg-slate-50 text-slate-500">Loading PWA...</div>;

            return (
                <div className="flex h-screen bg-slate-100 font-sans text-slate-800 overflow-hidden">
                    {/* Sidebar */}
                    <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform transition-transform duration-300 ease-in-out ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0`}>
                        <div className="p-6 border-b border-slate-700 flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold tracking-tight text-blue-400">TESDA / WS</h1>
                                <p className="text-xs text-slate-400">Strat Planner PWA v1.0</p>
                            </div>
                            <button onClick={() => setIsSidebarOpen(false)} className="md:hidden text-slate-400 hover:text-white">
                                <Icons.X size={20} />
                            </button>
                        </div>
                        
                        <nav className="p-4 space-y-2">
                            <NavButton active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon={<Icons.LayoutDashboard size={20} />}>Dashboard</NavButton>
                            <NavButton active={activeTab === 'swot'} onClick={() => setActiveTab('swot')} icon={<Icons.Target size={20} />}>SWOT Analysis</NavButton>
                            <NavButton active={activeTab === 'bsc'} onClick={() => setActiveTab('bsc')} icon={<Icons.PieChart size={20} />}>Balanced Scorecard</NavButton>
                            <NavButton active={activeTab === 'paps'} onClick={() => setActiveTab('paps')} icon={<Icons.ClipboardList size={20} />}>PAPs Management</NavButton>
                            <NavButton active={activeTab === 'team'} onClick={() => setActiveTab('team')} icon={<Icons.Users size={20} />}>Team & Governance</NavButton>
                            <NavButton active={activeTab === 'report'} onClick={() => setActiveTab('report')} icon={<Icons.FileText size={20} />}>Strategic Plan View</NavButton>
                        </nav>
                        
                        <div className="absolute bottom-0 w-full p-6 border-t border-slate-700">
                             <div className="text-xs text-slate-500 flex items-center gap-2">
                                <div className="w-2 h-2 rounded-full bg-emerald-500"></div>
                                Local Storage Active
                             </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 overflow-auto relative">
                        <div className="md:hidden bg-white p-4 shadow-sm flex items-center justify-between sticky top-0 z-20">
                            <h2 className="font-semibold text-slate-800">Strategic Planner</h2>
                            <button onClick={() => setIsSidebarOpen(true)} className="text-slate-600">
                                <Icons.Menu size={24} />
                            </button>
                        </div>

                        <div className="p-6 md:p-10 max-w-7xl mx-auto pb-20">
                            {activeTab === 'dashboard' && <DashboardView stats={stats} paps={paps} swot={swot} bsc={bsc} />}
                            {activeTab === 'paps' && <PapsManager paps={paps} onAdd={handleAddPap} onUpdate={handleUpdatePap} onDelete={handleDeletePap} />}
                            {activeTab === 'team' && <TeamManager team={team} onAdd={handleAddTeam} onUpdate={handleUpdateTeam} onDelete={handleDeleteTeam} />}
                            {activeTab === 'swot' && <SwotManager swot={swot} onAdd={handleAddSwot} onDelete={handleDeleteSwot} />}
                            {activeTab === 'bsc' && <BscManager bsc={bsc} swot={swot} onAdd={handleAddBsc} onDelete={handleDeleteBsc} />}
                            {activeTab === 'report' && <StrategicPlanReport paps={paps} team={team} swot={swot} bsc={bsc} totalBudget={stats.totalBudget} />}
                        </div>
                    </main>
                </div>
            );
        }

        // --- SUB COMPONENTS ---

        const NavButton = ({ active, onClick, icon, children }) => (
            <button 
                onClick={() => { onClick(); window.scrollTo(0,0); setIsSidebarOpen && setIsSidebarOpen(false); }}
                className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${
                active ? 'bg-blue-600 text-white shadow-md' : 'text-slate-300 hover:bg-slate-800 hover:text-white'
                }`}
            >
                {icon}
                <span className="font-medium">{children}</span>
            </button>
        );

        const DashboardView = ({ stats, paps, swot, bsc }) => (
            <div className="space-y-6">
                <div className="flex flex-col md:flex-row md:items-center justify-between">
                <div>
                    <h2 className="text-2xl font-bold text-slate-800">Executive Overview</h2>
                    <p className="text-slate-500">Snapshot of strategic planning progress for 2026-2030.</p>
                </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <StatCard title="Total Budget Required" value={new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP', maximumFractionDigits: 0 }).format(stats.totalBudget)} icon={<Icons.DollarSign className="text-emerald-500" />} trend="+12% vs last year" />
                <StatCard title="Planned PAPs" value={stats.totalProjects} icon={<Icons.ClipboardList className="text-blue-500" />} trend={`${stats.completionRate}% readiness`} />
                <StatCard title="Strategic Insights" value={swot.length} icon={<Icons.Target className="text-purple-500" />} trend="SWOT Items" />
                <StatCard title="Scorecard Objectives" value={bsc.length} icon={<Icons.PieChart className="text-orange-500" />} trend="Across 4 Perspectives" />
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 className="text-lg font-semibold mb-4 flex items-center space-x-2">
                    <Icons.TrendingUp size={20} className="text-slate-400" />
                    <span>Budget Allocation by Unit</span>
                    </h3>
                    {paps.length === 0 ? (
                    <div className="h-48 flex items-center justify-center text-slate-400 bg-slate-50 rounded-lg">No Data Available</div>
                    ) : (
                    <div className="space-y-4">
                        {Array.from(new Set(paps.map(p => p.unit))).slice(0, 5).map(unit => {
                        const unitTotal = paps.filter(p => p.unit === unit).reduce((sum, p) => sum + parseFloat(p.budget || 0), 0);
                        const percentage = Math.min(100, Math.round((unitTotal / stats.totalBudget) * 100));
                        return (
                            <div key={unit}>
                            <div className="flex justify-between text-sm mb-1">
                                <span className="font-medium text-slate-700">{unit}</span>
                                <span className="text-slate-500">{new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP', maximumFractionDigits: 0 }).format(unitTotal)}</span>
                            </div>
                            <div className="w-full bg-slate-100 rounded-full h-2">
                                <div className="bg-blue-600 h-2 rounded-full" style={{ width: `${percentage}%` }}></div>
                            </div>
                            </div>
                        )
                        })}
                    </div>
                    )}
                </div>

                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 className="text-lg font-semibold mb-4 flex items-center space-x-2">
                    <Icons.AlertTriangle size={20} className="text-slate-400" />
                    <span>Critical Risks (Threats)</span>
                    </h3>
                    <div className="space-y-3">
                        {swot.filter(s => s.type === 'Threat').length === 0 && <p className="text-slate-400 italic">No threats identified yet.</p>}
                        {swot.filter(s => s.type === 'Threat').slice(0, 4).map((threat, idx) => (
                            <div key={idx} className="flex items-start space-x-3 p-3 bg-red-50 rounded-lg border border-red-100">
                                <div className="mt-1 min-w-[6px] h-[6px] rounded-full bg-red-500"></div>
                                <p className="text-sm text-red-800">{threat.description}</p>
                            </div>
                        ))}
                    </div>
                </div>
                </div>
            </div>
        );

        const StatCard = ({ title, value, icon, trend }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <div className="flex justify-between items-start">
                <div>
                    <p className="text-sm font-medium text-slate-500">{title}</p>
                    <h3 className="text-2xl font-bold text-slate-800 mt-1">{value}</h3>
                </div>
                <div className="p-3 bg-slate-50 rounded-lg">{icon}</div>
                </div>
                <div className="mt-4 flex items-center text-sm">
                <span className="text-slate-400">{trend}</span>
                </div>
            </div>
        );

        const PapsManager = ({ paps, onAdd, onUpdate, onDelete }) => {
            const [formData, setFormData] = useState({ unit: '', name: '', pap: '', kpi: '', target: '', timeline: '', budget: '', accountable: '' });
            const [editingId, setEditingId] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                const payload = { ...formData, budget: parseFloat(formData.budget) || 0 };
                if (editingId) {
                    onUpdate(editingId, payload);
                    setEditingId(null);
                } else {
                    onAdd(payload);
                }
                setFormData({ unit: '', name: '', pap: '', kpi: '', target: '', timeline: '', budget: '', accountable: '' });
            };

            const startEdit = (pap) => {
                setEditingId(pap.id);
                setFormData(pap);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const cancelEdit = () => {
                setEditingId(null);
                setFormData({ unit: '', name: '', pap: '', kpi: '', target: '', timeline: '', budget: '', accountable: '' });
            };

            return (
                <div className="space-y-6">
                <div><h2 className="text-2xl font-bold text-slate-800">Programs, Activities & Projects</h2><p className="text-slate-500">Input and manage the strategic roadmap.</p></div>
                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 className="text-lg font-semibold mb-4 text-blue-800">{editingId ? 'Edit Entry' : 'Add New Entry'}</h3>
                    <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <input required placeholder="Unit" className="input-field" value={formData.unit} onChange={e => setFormData({...formData, unit: e.target.value})} />
                    <input required placeholder="Submitter" className="input-field" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                    <input required placeholder="PAP" className="input-field md:col-span-2" value={formData.pap} onChange={e => setFormData({...formData, pap: e.target.value})} />
                    <input required placeholder="KPI" className="input-field md:col-span-2" value={formData.kpi} onChange={e => setFormData({...formData, kpi: e.target.value})} />
                    <input required placeholder="Target" className="input-field" value={formData.target} onChange={e => setFormData({...formData, target: e.target.value})} />
                    <input required placeholder="Timeline" className="input-field" value={formData.timeline} onChange={e => setFormData({...formData, timeline: e.target.value})} />
                    <input required type="number" placeholder="Budget" className="input-field" value={formData.budget} onChange={e => setFormData({...formData, budget: e.target.value})} />
                    <input required placeholder="Accountable" className="input-field lg:col-span-2" value={formData.accountable} onChange={e => setFormData({...formData, accountable: e.target.value})} />
                    <div className="lg:col-span-4 flex justify-end space-x-2">
                        {editingId && (
                            <button type="button" onClick={cancelEdit} className="px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium">Cancel</button>
                        )}
                        <button type="submit" className="btn-primary">
                            {editingId ? <Icons.Pencil size={18} className="mr-2" /> : <Icons.Plus size={18} className="mr-2" />} 
                            {editingId ? 'Update Plan' : 'Add to Plan'}
                        </button>
                    </div>
                    </form>
                </div>
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left">
                        <thead className="bg-slate-50 text-slate-500 font-medium uppercase border-b border-slate-200">
                        <tr><th className="px-6 py-4">Unit</th><th className="px-6 py-4">PAP</th><th className="px-6 py-4">KPI / Target</th><th className="px-6 py-4">Timeline</th><th className="px-6 py-4 text-right">Budget</th><th className="px-6 py-4 text-right">Action</th></tr>
                        </thead>
                        <tbody className="divide-y divide-slate-100">
                        {paps.map((pap) => (
                            <tr key={pap.id} className={`hover:bg-slate-50 ${editingId === pap.id ? 'bg-blue-50' : ''}`}>
                            <td className="px-6 py-4 font-medium text-slate-900">{pap.unit}</td>
                            <td className="px-6 py-4"><div className="font-semibold text-blue-700">{pap.pap}</div><div className="text-xs text-slate-500">{pap.accountable}</div></td>
                            <td className="px-6 py-4"><div>{pap.kpi}</div><div className="text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full inline-block mt-1">{pap.target}</div></td>
                            <td className="px-6 py-4">{pap.timeline}</td>
                            <td className="px-6 py-4 text-right font-mono font-medium">{new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(pap.budget)}</td>
                            <td className="px-6 py-4 text-right flex justify-end space-x-2">
                                <button onClick={() => startEdit(pap)} className="text-blue-400 hover:text-blue-600"><Icons.Pencil size={18} /></button>
                                <button onClick={() => onDelete(pap.id)} className="text-red-400 hover:text-red-600"><Icons.Trash2 size={18} /></button>
                            </td>
                            </tr>
                        ))}
                        {paps.length === 0 && <tr><td colSpan="6" className="px-6 py-8 text-center text-slate-400 italic">No PAPs added yet.</td></tr>}
                        </tbody>
                    </table>
                    </div>
                </div>
                </div>
            );
        };

        const TeamManager = ({ team, onAdd, onUpdate, onDelete }) => {
            const [formData, setFormData] = useState({ name: '', designation: '', functions: '' });
            const [editingId, setEditingId] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingId) {
                    onUpdate(editingId, formData);
                    setEditingId(null);
                } else {
                    onAdd(formData);
                }
                setFormData({ name: '', designation: '', functions: '' });
            };

            const startEdit = (member) => {
                setEditingId(member.id);
                setFormData(member);
            };

            const cancelEdit = () => {
                setEditingId(null);
                setFormData({ name: '', designation: '', functions: '' });
            };

            return (
                <div className="space-y-6">
                <div><h2 className="text-2xl font-bold text-slate-800">Team & Governance</h2><p className="text-slate-500">Define committees, designations, and functions.</p></div>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-1 bg-white p-6 rounded-xl shadow-sm border border-slate-200 h-fit">
                    <h3 className="text-lg font-semibold mb-4 text-blue-800">{editingId ? 'Edit Member' : 'Add Member'}</h3>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <input required placeholder="Name" className="input-field" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                        <input required placeholder="Designation" className="input-field" value={formData.designation} onChange={e => setFormData({...formData, designation: e.target.value})} />
                        <textarea required placeholder="Functions" rows="3" className="input-field" value={formData.functions} onChange={e => setFormData({...formData, functions: e.target.value})} />
                        
                        <div className="flex space-x-2">
                            {editingId && (
                                <button type="button" onClick={cancelEdit} className="w-1/2 px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors font-medium">Cancel</button>
                            )}
                            <button type="submit" className={`btn-primary ${editingId ? 'w-1/2' : 'w-full'}`}>
                                {editingId ? <Icons.Pencil size={18} className="mr-2" /> : <Icons.Plus size={18} className="mr-2" />} 
                                {editingId ? 'Update' : 'Add'}
                            </button>
                        </div>
                    </form>
                    </div>
                    <div className="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
                    {team.map((member) => (
                        <div key={member.id} className={`bg-white p-5 rounded-xl shadow-sm border border-slate-200 relative group ${editingId === member.id ? 'border-blue-500 ring-1 ring-blue-500' : ''}`}>
                        <div className="absolute top-4 right-4 flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onClick={() => startEdit(member)} className="text-slate-300 hover:text-blue-500"><Icons.Pencil size={18} /></button>
                            <button onClick={() => onDelete(member.id)} className="text-slate-300 hover:text-red-500"><Icons.Trash2 size={18} /></button>
                        </div>
                        
                        <div className="flex items-center space-x-3 mb-3"><div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 font-bold text-lg">{member.name.charAt(0)}</div><div><h4 className="font-bold text-slate-800">{member.name}</h4><p className="text-xs text-blue-600 font-medium uppercase tracking-wide">{member.designation}</p></div></div>
                        <p className="text-sm text-slate-600">{member.functions}</p>
                        </div>
                    ))}
                    </div>
                </div>
                </div>
            );
        };

        const SwotManager = ({ swot, onAdd, onDelete }) => {
            const [formData, setFormData] = useState({ type: 'Strength', description: '' });
            const handleSubmit = (e) => { e.preventDefault(); onAdd(formData); setFormData({ ...formData, description: '' }); };
            const types = ['Strength', 'Weakness', 'Opportunity', 'Threat'];
            return (
                <div className="space-y-6">
                <div><h2 className="text-2xl font-bold text-slate-800">SWOT Analysis</h2><p className="text-slate-500">Identify internal and external factors.</p></div>
                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <form onSubmit={handleSubmit} className="flex gap-4">
                    <select className="input-field w-48" value={formData.type} onChange={e => setFormData({...formData, type: e.target.value})}>{types.map(t => <option key={t} value={t}>{t}</option>)}</select>
                    <input required placeholder="Description..." className="input-field flex-1" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />
                    <button type="submit" className="btn-primary">Add</button>
                    </form>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {types.map(type => (
                    <div key={type} className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 h-full">
                        <h3 className="font-bold text-lg mb-4 flex items-center"><span className={`w-3 h-3 rounded-full mr-2 ${type === 'Strength' ? 'bg-emerald-500' : type === 'Weakness' ? 'bg-orange-500' : type === 'Opportunity' ? 'bg-blue-500' : 'bg-red-500'}`}></span>{type}s</h3>
                        <ul className="space-y-2">
                        {swot.filter(s => s.type === type).map(item => (
                            <li key={item.id} className="p-3 rounded-lg border text-sm flex justify-between items-start group bg-slate-50 border-slate-200">
                            <span>{item.description}</span>
                            <button onClick={() => onDelete(item.id)} className="ml-2 text-slate-400 hover:text-slate-700 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.X size={14}/></button>
                            </li>
                        ))}
                        </ul>
                    </div>
                    ))}
                </div>
                </div>
            );
        };

        const BscManager = ({ bsc, swot, onAdd, onDelete }) => {
            const [formData, setFormData] = useState({ perspective: 'Stakeholder', objective: '', measure: '', relatedSwot: '' });
            
            const perspectives = [
                { id: 'Stakeholder', label: 'Stakeholder / Customer', icon: <Icons.Users className="text-blue-500" />, desc: 'What do our stakeholders need?' },
                { id: 'Internal Process', label: 'Internal Process', icon: <Icons.Activity className="text-green-500" />, desc: 'At which processes must we excel?' },
                { id: 'Learning & Growth', label: 'Learning & Growth', icon: <Icons.BookOpen className="text-purple-500" />, desc: 'How do we sustain ability to change?' },
                { id: 'Financial', label: 'Financial / Stewardship', icon: <Icons.ShieldCheck className="text-orange-500" />, desc: 'How do we ensure financial health?' },
            ];

            const handleSubmit = (e) => {
                e.preventDefault();
                onAdd(formData);
                setFormData({ perspective: 'Stakeholder', objective: '', measure: '', relatedSwot: '' });
            };

            return (
                <div className="space-y-8">
                <div>
                    <h2 className="text-2xl font-bold text-slate-800">Balanced Scorecard (BSC)</h2>
                    <p className="text-slate-500">Synthesize SWOT options into strategic objectives and measures.</p>
                </div>

                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 className="text-lg font-semibold mb-4 text-slate-700">Add Strategic Objective</h3>
                    <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="col-span-1">
                        <label className="text-xs font-bold text-slate-500 uppercase">Perspective</label>
                        <select className="input-field mt-1" value={formData.perspective} onChange={e => setFormData({...formData, perspective: e.target.value})}>
                        {perspectives.map(p => <option key={p.id} value={p.id}>{p.label}</option>)}
                        </select>
                    </div>
                    <div className="col-span-1">
                        <label className="text-xs font-bold text-slate-500 uppercase">Link to SWOT (Optional)</label>
                        <select className="input-field mt-1" value={formData.relatedSwot} onChange={e => setFormData({...formData, relatedSwot: e.target.value})}>
                        <option value="">-- None --</option>
                        {swot.map(s => <option key={s.id} value={s.description}>{s.type}: {s.description.substring(0, 40)}...</option>)}
                        </select>
                    </div>
                    <div className="col-span-2">
                        <label className="text-xs font-bold text-slate-500 uppercase">Strategic Objective</label>
                        <input required placeholder="e.g., Increase industry partnerships for apprenticeships" className="input-field mt-1" value={formData.objective} onChange={e => setFormData({...formData, objective: e.target.value})} />
                    </div>
                    <div className="col-span-2">
                        <label className="text-xs font-bold text-slate-500 uppercase">Key Measure (KPI)</label>
                        <input required placeholder="e.g., % of graduates employed within 3 months" className="input-field mt-1" value={formData.measure} onChange={e => setFormData({...formData, measure: e.target.value})} />
                    </div>
                    <div className="col-span-2 flex justify-end">
                        <button type="submit" className="btn-primary"><Icons.Plus size={18} className="mr-2" /> Add Objective</button>
                    </div>
                    </form>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {perspectives.map(p => (
                    <div key={p.id} className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col h-full">
                        <div className="flex items-center space-x-3 mb-4 pb-3 border-b border-slate-100">
                        <div className="p-2 bg-slate-50 rounded-lg">{p.icon}</div>
                        <div>
                            <h3 className="font-bold text-slate-800">{p.label}</h3>
                            <p className="text-xs text-slate-400">{p.desc}</p>
                        </div>
                        </div>
                        <div className="flex-1 space-y-3">
                        {bsc.filter(item => item.perspective === p.id).map(item => (
                            <div key={item.id} className="p-3 bg-slate-50 rounded border border-slate-100 relative group">
                            <button onClick={() => onDelete(item.id)} className="absolute top-2 right-2 text-slate-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"><Icons.X size={14}/></button>
                            <div className="font-medium text-slate-800 text-sm">{item.objective}</div>
                            <div className="text-xs text-slate-500 mt-1 flex items-center">
                                <Icons.Target size={12} className="mr-1 text-slate-400" />
                                Measure: {item.measure}
                            </div>
                            {item.relatedSwot && (
                                <div className="mt-2 text-[10px] bg-yellow-50 text-yellow-800 px-2 py-1 rounded inline-block border border-yellow-100">
                                Linking: {item.relatedSwot}
                                </div>
                            )}
                            </div>
                        ))}
                        {bsc.filter(item => item.perspective === p.id).length === 0 && (
                            <div className="text-center py-6 text-slate-300 text-sm border-2 border-dashed border-slate-100 rounded">
                            No objectives defined
                            </div>
                        )}
                        </div>
                    </div>
                    ))}
                </div>
                </div>
            );
        };

        const StrategicPlanReport = ({ paps, team, swot, bsc, totalBudget }) => {
            return (
                <div className="space-y-8">
                    <div className="flex justify-between items-center no-print">
                        <div><h2 className="text-2xl font-bold text-slate-800">Strategic Plan 2026-2030</h2><p className="text-slate-500">Consolidated view for printing.</p></div>
                        <button onClick={() => window.print()} className="btn-primary bg-slate-800 hover:bg-slate-700"><Icons.Download size={18} className="mr-2" /> Print / PDF</button>
                    </div>

                    <div className="bg-white p-10 shadow-lg border border-slate-200 max-w-5xl mx-auto printable-content">
                        <div className="text-center border-b-2 border-blue-900 pb-6 mb-8">
                            <h1 className="text-3xl font-bold text-blue-900 uppercase tracking-wider">Strategic Plan</h1>
                            <p className="text-slate-500 mt-2 text-lg">WorldSkills Philippines / TESDA</p>
                            <p className="text-sm text-slate-400 mt-1">Generated: {new Date().toLocaleDateString()}</p>
                        </div>

                        <div className="mb-10 break-inside-avoid">
                        <h2 className="text-xl font-bold text-slate-800 mb-4 border-l-4 border-blue-500 pl-3">Strategy Map (Balanced Scorecard)</h2>
                        <div className="space-y-4">
                            {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map((p, idx) => (
                            <div key={p} className="border border-slate-300 rounded-lg p-4 flex">
                                <div className="w-40 font-bold text-slate-700 flex items-center border-r border-slate-200 pr-4">
                                    {p}
                                </div>
                                <div className="flex-1 pl-4 grid grid-cols-2 gap-2">
                                {bsc.filter(b => b.perspective === p).map(b => (
                                    <div key={b.id} className="bg-slate-50 border border-slate-200 rounded p-2 text-xs">
                                        <div className="font-bold text-slate-800">{b.objective}</div>
                                        <div className="text-slate-500 italic mt-1">Meas: {b.measure}</div>
                                    </div>
                                ))}
                                {bsc.filter(b => b.perspective === p).length === 0 && <span className="text-slate-300 italic text-xs">No objectives defined.</span>}
                                </div>
                            </div>
                            ))}
                        </div>
                        </div>

                        <div className="mb-10 break-inside-avoid">
                            <h2 className="text-xl font-bold text-slate-800 mb-4 border-l-4 border-blue-500 pl-3">Strategic Context (SWOT)</h2>
                            <div className="grid grid-cols-2 gap-4">
                                {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(t => (
                                <div key={t} className="border border-slate-200 p-4 rounded bg-slate-50">
                                    <h3 className="font-bold text-slate-800 mb-2 border-b border-slate-200 pb-1">{t}s</h3>
                                    <ul className="list-disc pl-4 text-sm text-slate-700 space-y-1">
                                        {swot.filter(s => s.type === t).map((s, i) => <li key={i}>{s.description}</li>)}
                                    </ul>
                                </div>
                                ))}
                            </div>
                        </div>

                        <div className="mb-10">
                            <h2 className="text-xl font-bold text-slate-800 mb-4 border-l-4 border-blue-500 pl-3">Program of Activities (PAPs)</h2>
                            <table className="w-full text-xs text-left border-collapse">
                                <thead className="bg-slate-100 text-slate-700 uppercase font-bold">
                                    <tr><th className="border p-2">Unit</th><th className="border p-2">PAP / Name</th><th className="border p-2">KPI / Target</th><th className="border p-2">Timeline</th><th className="border p-2 text-right">Budget</th><th className="border p-2">Accountable</th></tr>
                                </thead>
                                <tbody>
                                    {paps.map((pap, idx) => (
                                        <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-slate-50'}>
                                            <td className="border p-2">{pap.unit}</td>
                                            <td className="border p-2 font-semibold">{pap.pap}<div className="text-slate-400 font-normal mt-1 text-[10px]">Submitted by: {pap.name}</div></td>
                                            <td className="border p-2"><div>{pap.kpi}</div><div className="italic text-slate-500 mt-1">Tgt: {pap.target}</div></td>
                                            <td className="border p-2">{pap.timeline}</td>
                                            <td className="border p-2 text-right font-mono">{new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(pap.budget)}</td>
                                            <td className="border p-2">{pap.accountable}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        <div className="break-inside-avoid">
                            <h2 className="text-xl font-bold text-slate-800 mb-4 border-l-4 border-blue-500 pl-3">Governance Structure</h2>
                            <div className="grid grid-cols-2 gap-4">
                                {team.map((m, i) => (
                                    <div key={i} className="flex space-x-3 border-b border-slate-100 pb-3">
                                        <div className="font-bold text-slate-800 w-1/3">{m.name}</div>
                                        <div className="w-2/3"><div className="text-xs font-bold uppercase text-blue-700">{m.designation}</div><div className="text-xs text-slate-500 mt-1">{m.functions}</div></div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <!-- PWA Injection Script -->
    <script>
        // 1. Inject Manifest dynamically
        const manifest = {
            "name": "Strategic Planner",
            "short_name": "StratPlan",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#1e293b",
            "theme_color": "#1e293b",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M3 3h7v9H3zM14 3h7v5h-7zM14 12h7v9h-7zM3 16h7v5H3z'/%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        };
        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);

        // 2. Register Service Worker for Offline Capabilities
        if ('serviceWorker' in navigator) {
            const swContent = `
                const CACHE_NAME = 'strat-plan-v1';
                self.addEventListener('install', (e) => {
                    e.waitUntil(
                        caches.open(CACHE_NAME).then((cache) => {
                            return cache.addAll([
                                'https://cdn.tailwindcss.com',
                                'https://unpkg.com/react@18/umd/react.production.min.js',
                                'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
                                'https://unpkg.com/@babel/standalone/babel.min.js'
                            ]);
                        })
                    );
                });
                self.addEventListener('fetch', (e) => {
                    e.respondWith(
                        caches.match(e.request).then((response) => response || fetch(e.request))
                    );
                });
            `;
            const swBlob = new Blob([swContent], {type: 'text/javascript'});
            const swUrl = URL.createObjectURL(swBlob);
            navigator.serviceWorker.register(swUrl)
                .then(() => console.log('PWA Service Worker Registered'))
                .catch((err) => console.log('SW Error:', err));
        }
    </script>
</body>
</html>
